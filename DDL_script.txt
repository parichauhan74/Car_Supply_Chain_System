CREATE SCHEMA "SUPPLY_CHAIN_MANAGEMENT";
SET SEARCH_PATH TO 'SUPPLY_CHAIN_MANAGEMENT';

--1)
CREATE TABLE SUPPLIER
(
    	SUPPLIER_ID VARCHAR(20),
    	SUPPLIER_NAME VARCHAR(50) NOT NULL,
    	SUPPLIER_TYPE CHAR(1) NOT NULL,
    	EMAIL_ID VARCHAR(50) ,
    	COUNTRY VARCHAR(30) NOT NULL,
     	STATE VARCHAR(30) NOT NULL,
    	CITY VARCHAR(30) NOT NULL,
    	CONTACT_NO VARCHAR(10)NOT NULL,
    	PRIMARY KEY (SUPPLIER_ID)
);

--2)
CREATE TABLE PARTS
(
    	PART_ID VARCHAR(20),
    	PART_NAME VARCHAR(20) NOT NULL,
	UNIT_PRICE DECIMAL(10,2) NOT NULL,
	PRIMARY KEY (PART_ID)
);

--3)
CREATE TABLE SUPPLIES_PARTS
(
	SUPPLIER_ID VARCHAR(20),
	PART_ID VARCHAR(20),
	QUANTITY_STOCK VARCHAR(10) NOT NULL,
	PRIMARY KEY (PART_ID , SUPPLIER_ID),
	FOREIGN KEY (SUPPLIER_ID) REFERENCES SUPPLIER(SUPPLIER_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (PART_ID) REFERENCES PARTS(PART_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--4)
CREATE TABLE ORDERS_OF_SUPPLIER
(
	ORDERING_SUPPLIER VARCHAR(20),
	PROVIDING_SUPPLIER VARCHAR(20),
	ORDERED_PART_ID VARCHAR(20),
	SUPPLIER_ORDER_NO INTEGER,
	QTY VARCHAR(10),
	AMOUNT DECIMAL(10,2) NOT NULL,
	PRIMARY KEY (ORDERING_SUPPLIER, PROVIDING_SUPPLIER, ORDERED_PART_ID, SUPPLIER_ORDER_NO),
	FOREIGN KEY (ORDERING_SUPPLIER) REFERENCES SUPPLIER(SUPPLIER_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (PROVIDING_SUPPLIER) REFERENCES SUPPLIER(SUPPLIER_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (ORDERED_PART_ID) REFERENCES PARTS(PART_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--5)
CREATE TABLE MANUFACTURER
(
	M_ID VARCHAR(20),
	M_NAME VARCHAR(50) NOT NULL,
	CONTACT_NO VARCHAR(10) NOT NULL ,
	EMAIL_ID VARCHAR(50),
	COUNTRY VARCHAR(30) NOT NULL,
	STATE VARCHAR(30) NOT NULL,
	CITY VARCHAR(30) NOT NULL,
	PRIMARY KEY (M_ID)
);

--6)
CREATE TABLE ORDER_OF_MANUFACTURER
(
	ORDER_NO VARCHAR(20),
	M_ID VARCHAR(20),
	PLACING_DATE DATE NOT NULL,
	RECEIVING_DATE DATE ,
	PRIMARY KEY (ORDER_NO),
	FOREIGN KEY (M_ID) REFERENCES MANUFACTURER(M_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--7)
CREATE TABLE ORDER_FOR_PARTS
(
	PART_ID VARCHAR(20),
	ORDER_NO VARCHAR(20),
	QUANTITY VARCHAR(10) NOT NULL,
	PRIMARY KEY(PART_ID, ORDER_NO),
	FOREIGN KEY (PART_ID) REFERENCES PARTS(PART_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (ORDER_NO) REFERENCES ORDER_OF_MANUFACTURER(ORDER_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--8)
CREATE TABLE ORDER_TRANSACTIONS
(
	TRANSACTION_ID VARCHAR(20),
	ORDER_NO VARCHAR(20) NOT NULL,
	ORDERED_AMOUNT DECIMAL(10,2),
	TAX_NAME VARCHAR(20),
	TAX_IN_PERCENTAGE DECIMAL(5,2),
	TOTAL_AMOUNT DECIMAL(10,2) NOT NULL,
	PRIMARY KEY (TRANSACTION_ID),
	FOREIGN KEY (ORDER_NO) REFERENCES ORDER_OF_MANUFACTURER(ORDER_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--9)
CREATE TABLE CAR_MODEL
(
	CAR_MODEL_ID VARCHAR(20),
	MODEL_NAME VARCHAR(25) NOT NULL,
	MILEAGE_IN_KMPL DECIMAL(10,2) NOT NULL,
	COLOR VARCHAR(20),
	WARRANTY_DURATION_MONTHS INTEGER,
	PRIMARY KEY (CAR_MODEL_ID)
);

--10)
CREATE TABLE ORDER_BASED_ON
(
	ORDER_NO VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	PRIMARY KEY(ORDER_NO, CAR_MODEL_ID),
	FOREIGN KEY (ORDER_NO) REFERENCES ORDER_OF_MANUFACTURER(ORDER_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (CAR_MODEL_ID) REFERENCES CAR_MODEL(CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--11)
CREATE TABLE ASSEMBLY_PLANT
(
	PLANT_NO VARCHAR(20),
	M_ID VARCHAR(20),
	COUNTRY VARCHAR(20) NOT NULL,
	STATE VARCHAR(20) NOT NULL,
	CITY VARCHAR(20) NOT NULL,
	PRIMARY KEY(PLANT_NO),
	FOREIGN KEY (M_ID) REFERENCES MANUFACTURER(M_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--12)
CREATE TABLE PLANT_HEAD
(
	PHEAD_ID VARCHAR(20),
	H_NAME VARCHAR(20) NOT NULL,
	PLANT_NO VARCHAR(20) NOT NULL,
	CONTACT_NO VARCHAR(10) NOT NULL,
	PRIMARY KEY(PHEAD_ID),
	FOREIGN KEY (PLANT_NO) REFERENCES ASSEMBLY_PLANT(PLANT_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--13)
CREATE TABLE MANUFACTURED_PARTS_BY_OWN 
(
	COMPONENT_ID VARCHAR(20),
	COMPONENT_NAME VARCHAR(20) NOT NULL,
	CAR_MODEL_ID VARCHAR(20),
	M_ID VARCHAR(20) ,
	UNIT_PRICE DECIMAL(10,2) NOT NULL,
	QUALITY_FACTORS VARCHAR(100),
	PRIMARY KEY(COMPONENT_ID),
	FOREIGN KEY (M_ID) REFERENCES MANUFACTURER(M_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (CAR_MODEL_ID) REFERENCES CAR_MODEL(CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--14)
CREATE TABLE PLANT_PRODUCES 
(
	PLANT_NO VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	START_DATE DATE NOT NULL,
	END_DATE DATE ,
	PRIMARY KEY (PLANT_NO , CAR_MODEL_ID),
	FOREIGN KEY (CAR_MODEL_ID) REFERENCES CAR_MODEL(CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (PLANT_NO) REFERENCES ASSEMBLY_PLANT(PLANT_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--15)
CREATE TABLE DEALER 
(
	DEALER_ID VARCHAR(20),
	DEALER_NAME VARCHAR(50) NOT NULL,
	DEALS_WITH_M_ID VARCHAR(20),
	CONTACT_NO VARCHAR(10) NOT NULL,
	EMAIL_ID VARCHAR(50),
	COUNTRY VARCHAR(30) NOT NULL,
	STATE VARCHAR(30) NOT NULL,
	CITY VARCHAR(30) NOT NULL,
	PRIMARY KEY(DEALER_ID),
	FOREIGN KEY (DEALS_WITH_M_ID) REFERENCES MANUFACTURER(M_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--16)
CREATE TABLE DEALER_ORDER_FOR
(
	DEALER_ID VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	ORDERING_DATE DATE NOT NULL,
	RECEIVING_DATE DATE ,
	TAX_NAME VARCHAR(20),
	TAX_IN_PERCENTAGE DECIMAL(5,2),
	TOTAL_AMOUNT DECIMAL(18,2) NOT NULL,
	PRIMARY KEY(DEALER_ID, CAR_MODEL_ID),
	FOREIGN KEY (DEALER_ID) REFERENCES DEALER(DEALER_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (CAR_MODEL_ID) REFERENCES CAR_MODEL(CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--17)
CREATE TABLE TEST
(
	TEST_NAME VARCHAR(20) PRIMARY KEY
);

--18)
CREATE TABLE CAR_TEST 
(
	TEST_NAME VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	RESULT CHAR(1),
	PRIMARY KEY(TEST_NAME, CAR_MODEL_ID),
	FOREIGN KEY (CAR_MODEL_ID) REFERENCES CAR_MODEL(CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (TEST_NAME) REFERENCES TEST(TEST_NAME)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

--19)
CREATE TABLE CUSTOMER 
(
	CUSTOMER_ID VARCHAR(20),
	CUSTOMER_NAME VARCHAR(50) NOT NULL,
	CONTACT_NO VARCHAR(10) NOT NULL,
	EMAIL_ID VARCHAR(50),
	COUNTRY VARCHAR(30) NOT NULL,
	STATE VARCHAR(30) NOT NULL,
	CITY VARCHAR(30) NOT NULL,
 	PRIMARY KEY(CUSTOMER_ID)
);


--20)
CREATE TABLE RTO
(
	REGISTRATION_NO VARCHAR(20),
	ENGINE_NO VARCHAR(20) NOT NULL,
	REGISTRATION_DATE DATE NOT NULL,
	VIN VARCHAR(20) NOT NULL,
	TOTAL_REG_AMOUNT DECIMAL(10,2) NOT NULL,
	ROAD_TAX_AMOUNT DECIMAL(10,2)NOT NULL,
	PRIMARY KEY(REGISTRATION_NO)
);




--21)
CREATE TABLE SELLS_TO 
(
	DEALER_ID VARCHAR(20),
	CUSTOMER_ID VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	REGISTRATION_NO VARCHAR(20),
	SELLING_DATE DATE NOT NULL,
	CAR_AMOUNT DECIMAL(18,2) NOT NULL,
	TAX_NAME VARCHAR(20) ,
	TAX_IN_PERCENTAGE DECIMAL(5,2),
	DISCOUNT_AMOUNT DECIMAL(10,2),
	PRIMARY KEY(DEALER_ID, CUSTOMER_ID, CAR_MODEL_ID),
	FOREIGN KEY (DEALER_ID, CAR_MODEL_ID) REFERENCES DEALER_ORDER_FOR(DEALER_ID, CAR_MODEL_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (REGISTRATION_NO) REFERENCES RTO(REGISTRATION_NO)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
	FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID)
	ON UPDATE CASCADE
 	ON DELETE CASCADE
);

--22)
CREATE TABLE INSURANCE
(
	IN_POLICY_NO VARCHAR(20),
	COMPANY_NAME VARCHAR(20) NOT NULL,
	CUSTOMER_ID VARCHAR(20),
	DEALER_ID VARCHAR(20),
	CAR_MODEL_ID VARCHAR(20),
	START_DATE DATE NOT NULL,
	END_DATE DATE NOT NULL,
	COVERAGE_AMOUNT DECIMAL(18,2) NOT NULL,
	INSURANCE_AMOUNT DECIMAL(18,2) NOT NULL,
	PRIMARY KEY (IN_POLICY_NO),
	FOREIGN KEY (DEALER_ID,CAR_MODEL_ID,CUSTOMER_ID) REFERENCES SELLS_TO(DEALER_ID,CAR_MODEL_ID,CUSTOMER_ID)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);